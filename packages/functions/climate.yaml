---
# Weather

# fetch weather data from a local weather station (Vlinder project)
rest:
  resource: https://wow.meteo.be/services/wow/ajax/getLatestObservation.php?id=23f30a34-269b-e911-80e7-0003ff59889d
  scan_interval: 60
  sensor:
    - name: "vlinder_data_temperature"
      value_template: '{{ value_json["primary"]["dt"] }}'
      unit_of_measurement: 'Â°C'
    - name: "vlinder_data_wind_speed"
      value_template: '{{ value_json["primary"]["dws"] }}'
      unit_of_measurement: 'km/h'
    - name: "vlinder_data_wind_direction"
      value_template: '{{ value_json["primary"]["dwd"] }}'
    - name: "vlinder_data_humidity"
      value_template: '{{ value_json["primary"]["dh"] }}'
      unit_of_measurement: '%'
    - name: "vlinder_data_pressure"
      value_template: '{{ value_json["primary"]["dm"] }}'
      unit_of_measurement: 'hPa'
    - name: "vlinder_data_rainfall"
      value_template: '{{ value_json["primary"]["drr"] }}'
      unit_of_measurement: 'mm/h'

# meteo Alarm sensor for Antwerp, Belgium
binary_sensor:
  - platform: meteoalarm
    country: "belgium"
    province: "Antwerp"
    language: "nl-BE"

# average indoor temperature
sensor:
  - platform: min_max
    name: Average indoor temperature
    type: mean
    round_digits: 1
    entity_ids:
      - sensor.hue_motion_sensor_3_temperature
      - sensor.hue_motion_sensor_4_temperature
      - sensor.hue_motion_sensor_5_temperature

automation:
    # send notification on severe weather warnings
  - alias: 'notification - severe weather'
    id: weather_severe_weather_notification
    trigger:
      - platform: state
        entity_id: binary_sensor.meteoalarm
        from: 'off'
    action:
      - service: notify.parents_phone_app
        data:
          title: "{{state_attr('binary_sensor.meteoalarm', 'headline')}}"
          message: "{{state_attr('binary_sensor.meteoalarm', 'description')}} vanaf {{state_attr('binary_sensor.meteoalarm', 'effective')}}"